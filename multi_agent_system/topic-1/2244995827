This paper proposes a new approach for the analysis of consensus of multi-agent systems subject to time-varying delayed control inputs and switching topology. The main contribution is a condition for consensus for a networked system based on linear matrix inequalities that takes into account the joint effect of time-varying delays and switching network topology. Topology changes are modeled using Markov jumps with uncertain rates of transitions. A practical example is shown to illustrate the main result in various scenarios.